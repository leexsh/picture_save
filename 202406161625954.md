# 在测试环境中搭建 es 和 kibana 环境

如果想快速启动 Elasticsearch（和 Kibana）进行本地开发或测试，请使用此设置。不要用于生产环境，仅用于个人学习。

# 0 docker 安装

1. 如果尚未安装 Docker，请下载并安装适合您的操作系统的 [Docker](https://www.docker.com/products/docker-desktop)
2. 设置环境变量

```sql
export ELASTIC_PASSWORD="<ES_PASSWORD>"  # password for "elastic" username
export KIBANA_PASSWORD="<KIB_PASSWORD>"   # Used _internally_ by Kibana, must be at least 6 characters long
```

把环境变量写入到.zshrc 中，修改用户 elastic 的密码和 kibana 连接 es 的密码，完成后，source .zshrc

# 1 创建 docker 网络

要运行 Elasticsearch 和 Kibana，需要创建一个 Docker 网络：

```sql
docker network elastic - net
```

# 2 运行 Elasticsearch

```sql
docker run -p 127.0.0.1:9200:9200 -d --name elasticsearch --network elastic-net \
  -e ELASTIC_PASSWORD=$ELASTIC_PASSWORD \
  -e "discovery.type=single-node" \
  -e "xpack.security.http.ssl.enabled=false" \
  -e "xpack.license.self_generated.type=trial" \
  elasticsearch:8.14.0 -- 选择合适的docker 版本
```

运行后可以 dokcer ps 查看 es 的状态，可以登录 localhost:9200 查看状态

![](static/L6dmbzJzjo1SkmxUPoxcB4NInHq.png)

# 3 运行 kibana

要运行 Kibana，您必须首先 `kibana_system` 在 Elasticsearch 容器中设置密码。

```sql
# configure the Kibana password in the ES container
curl -u elastic:$ELASTIC_PASSWORD \
  -X POST \
  http://localhost:9200/_security/user/kibana_system/_password \
  -d '{"password":"'"$KIBANA_PASSWORD"'"}' \
  -H 'Content-Type: application/json'
```

运行 kibana 容器

```sql
docker run -p 127.0.0.1:5601:5601 -d --name kibana --network elastic-net \
  -e ELASTICSEARCH_URL=http://elasticsearch:9200 \
  -e ELASTICSEARCH_HOSTS=http://elasticsearch:9200 \
  -e ELASTICSEARCH_USERNAME=kibana_system \
  -e ELASTICSEARCH_PASSWORD=$KIBANA_PASSWORD \
  -e "xpack.security.enabled=false" \
  -e "xpack.license.self_generated.type=trial" \
  kibana:8.14.0
```

# 4 大功告成

后续可以用 es 的客户端，查询和写入数据
